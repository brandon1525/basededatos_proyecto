<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" type="image/x-icon" href="images/place4.ico">
    <title>Sistema de Localización de la Universidad Autónoma de Aguascalientes</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  	<link rel="stylesheet" type="text/css" href="css/estilos.css">
  	<link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
  	<link href='https://fonts.googleapis.com/css?family=Gloria+Hallelujah' rel='stylesheet' type='text/css'>
  	<link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
  	<link href='https://fonts.googleapis.com/css?family=Gloria+Hallelujah' rel='stylesheet' type='text/css'>
  	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.0/css/bootstrap-toggle.min.css" rel="stylesheet">
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/funciones.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.0/js/bootstrap-toggle.min.js"></script>
</head>
<body>
<div class="container">
	<p></p>
	<div class="row">
		<div class="col-xs-11"></div>
		<div class="col-xs-1">
			<button type="button" class="btn btn-lg" id="btn_salir">salir</button>
		</div>
	</div>
	<div class="row">
		<h2 id="texto_cabeza" class="text-center">Por favor selecciona tu configuracion y da click en guardar</h2>
	</div>
	<div class="row">
		<div class="col-xs-4"></div>
		<div class="col-xs-2">
		  <label id="text-ingresa-datos"> Compartir Ubicacion</label>
		</div>
		<div class="col-xs-2">
			<input type="checkbox" data-toggle="toggle" id="1">
		</div>
	</div>
	<p></p>
	<div class="row">
		<div class="col-xs-4"></div>
		<div class="col-xs-2">
		  <label id="text-ingresa-datos">Compartir Horario</label>
		</div>
		<div class="col-xs-2">
			<input type="checkbox" data-toggle="toggle" id="2">
		</div>
	</div>
	<p></p>
	<div class="row">
		<div class="col-xs-4"></div>
		<div class="col-xs-2">
		  <label id="text-ingresa-datos">Compartir Profesor</label>
		</div>
		<div class="col-xs-2">
			<input type="checkbox" data-toggle="toggle" id="3">
		</div>
	</div>
	<p></p>
	<div class="row">
		<div class="col-xs-8"></div>
		<div class="col-xs-2">
			<button type="button" class="btn btn-lg" id="btn_guardar">Guardar</button>
		</div>
	</div>
	<p></p>
	<div class="row">
		<h2 id="texto_cabeza" class="text-center">Si deseas cambiar tu contraseña por favor da click en el boton cambiar contraseña</h2>
	</div>
	<div class="row">
		<div class="col-xs-4"></div>
		<div class="col-xs-4 text-center">
			<button type="button" class="btn btn-lg" data-toggle="collapse" data-target="#cambiar_contra" id="btn_cambiar_contra">Cambiar contraseña</button>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-2"></div>
		<div class="col-xs-8">
			<div id="cambiar_contra" class="collapse">
				<div class="form-group">
				    <label for="old_passw">Contraseña anterior</label>
				    <input type="password" class="form-control" id="old_passw" placeholder="Contraseña anterior">
				  </div>
				  <div class="form-group">
				    <label for="new_passw">Nueva contraseña</label>
				    <input type="password" class="form-control" id="new_passw" placeholder="Nueva Contraseña">
				  </div>
				  <div class="form-group">
				    <label for="new_passw_1">Repetir nueva contraseña</label>
				    <input type="password" class="form-control" id="new_passw_1" placeholder="Nueva Contraseña">
				  </div>
				  <div class="row">
					<div class="col-xs-10"></div>
					<div class="col-xs-2">
						<button type="button" class="btn btn-lg" id="btn_cambiar_con">Cambiar</button>
					</div>
				</div>
  			</div>
		</div>
	</div>
</div>
</body>
</html>
<script>
	$(document).ready(function(){
		$('input[type=checkbox][data-toggle^=toggle]').bootstrapToggle();
		var configuracion_persona=JSON.parse(localStorage.configuracion_persona);
	    console.log(configuracion_persona[0]);
	    console.log(configuracion_persona[0].COMPARTIR_UBICACION);
	    console.log(configuracion_persona[0].COMPARTIR_HORARIO);
	    console.log(configuracion_persona[0].COMPARTIR_PROFESOR);
	    var comp_ubicacion=configuracion_persona[0].COMPARTIR_UBICACION;
	    var comp_horario=configuracion_persona[0].COMPARTIR_HORARIO;
	    var comp_profe=configuracion_persona[0].COMPARTIR_PROFESOR;

	    if(comp_ubicacion=="1" || comp_ubicacion==1){
	    	$('#1').bootstrapToggle('on');
	    }else{
	    	$('#1').bootstrapToggle('off')
	    }
	    if(comp_horario=="1" || comp_horario==1){
	    	$('#2').bootstrapToggle('on');
	    }else{
	    	$('#2').bootstrapToggle('off');
	    }
	    if(comp_profe=="1" || comp_profe==1){
	    	$('#3').bootstrapToggle('on');
	    }else{
	    	$('#3').bootstrapToggle('off');
	    }
		$('#btn_guardar').click(function() {
			var compartir_ubicacion;
			var compartir_horario;
			var compartir_profesor;
			if($('#1').is(':checked')) {
            	compartir_ubicacion="1";
	        } else {  
	           	compartir_ubicacion="0"; 
	        }
	        if($('#2').is(':checked')) {
            	compartir_horario="1";
	        } else {  
	           	compartir_horario="0"; 
	        } 
	        if($('#3').is(':checked')) {
            	compartir_profesor="1";
	        } else {  
	           	compartir_profesor="0"; 
	        }
	        var datos_persona=JSON.parse(localStorage.datos_persona);
	        console.log(datos_persona);
	        var id=datos_persona[0].ID;
	        var id_configuracion=compartir_ubicacion+compartir_horario+compartir_profesor;
	        console.log(compartir_ubicacion);
			console.log(compartir_horario);
			console.log(compartir_profesor);
	        switch(id_configuracion){
	        	case "000":
	        		id_configuracion=8;
	        	break;
	        	case "001":
	        		id_configuracion=7;
	        	break;
	        	case "010":
	        		id_configuracion=6;
	        	break;
	        	case "011":
	        		id_configuracion=5;
	        	break;
	        	case "100":
	        		id_configuracion=4;
	        	break;
	        	case "101":
	        		id_configuracion=3;
	        	break;
	        	case "110":
	        		id_configuracion=2;
	        	break;
	        	case "111":
	        		id_configuracion=1;
	        	break;
	        }
	        $.ajax({
				url: "http://siluaa.mybluemix.net/API/guardar_config.php",
				method: 'GET',
				data: {id: id, id_configuracion: id_configuracion},
				dataType:'json',
				mimeType: 'application/json'
			}).done(function(json) {
				if(json.result=="true"){
					alert("Cambios realizados");
				}else{
				   	alert("Algo salió mal");
				}
			});
		});
		$('#btn_cambiar_con').click(function(){
			if($('#old_passw').val()=="" || $('#old_passw').val()==null){
				alert("Ingresa tu contraseña anterior");
				return;
			}else if($('#new_passw').val()=="" || $('#new_passw').val()==null){
				alert("Ingresa la nueva contraseña");
				return;
			}else if($('#new_passw_1').val()=="" || $('#new_passw_1').val()==null){
				alert("Ingresa la nueva contraseña nuevamente");
				return;
			}else{
				var datos_persona=JSON.parse(localStorage.datos_persona);
	        	var contra=datos_persona[0].CONTRA;
	        	var id=datos_persona[0].ID;
				if($('#old_passw').val()!=contra){
					alert("La contraseña anterior no coincide");
					return;
				}else{
					if($('#new_passw').val()!=$('#new_passw_1').val()){
						alert("Las nuevas contraseñas no coinciden");
						return;
					}else{
						$.ajax({        
				          url: "http://siluaa.mybluemix.net/API/guardar_contra.php",
				          method: 'GET',
				          data: {id: id, contra: $('#new_passw').val()},
				          dataType:'json',
				          mimeType: 'application/json'
				        }).done(function(json){
					        if(json.result=="true"){
					        	alert("Contraseña cambiada con éxito");
					    	}else{
					        	alert(json.mensaje);
					        }
				       	});
					}
				}
			}
		});
		$('#btn_salir').click(function () {
			window.location="log-in.html";
		});
	});
</script>